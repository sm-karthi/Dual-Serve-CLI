{"version":3,"sources":["../src/cli.ts"],"sourcesContent":["import { Command } from \"commander\";\r\nimport { resolve, join } from \"path\";\r\nimport degit from \"degit\";\r\nimport fs from \"fs\";\r\n\r\nconst program = new Command();\r\n\r\nprogram\r\n  .name(\"dual-serve\")\r\n  .description(\"Dual Serve is a CLI tool for create serverless project\")\r\n  .version(\"1.0.0\");\r\n\r\n// Fixed command definition\r\nprogram\r\n  .command(\"new <project-name>\") // Define required argument\r\n  .description(\"Create project\")\r\n  .action(async (projectName) => {\r\n    // Get project name from argument\r\n    const targetDir = resolve(process.cwd(), projectName);\r\n    const repo = \"Grids-and-Guides/Dual-Serve\";\r\n\r\n    console.log(`Creating project in ${targetDir}`);\r\n    const emitter = degit(repo, { cache: false, force: true });\r\n\r\n    try {\r\n      await emitter.clone(targetDir);\r\n\r\n      // Path to package.json\r\n      const packageJsonPath = join(targetDir, \"package.json\");\r\n\r\n      // Update package.json name\r\n      if (fs.existsSync(packageJsonPath)) {\r\n        const pkg = JSON.parse(fs.readFileSync(packageJsonPath, \"utf-8\"));\r\n\r\n        pkg.name = projectName;\r\n\r\n        fs.writeFileSync(packageJsonPath, JSON.stringify(pkg, null, 2));\r\n      }\r\n\r\n      // Path to app-config.ts\r\n      const appConfigPath = join(targetDir, \"bin\", \"app-config.ts\");\r\n\r\n      if (fs.existsSync(appConfigPath)) {\r\n        let content = fs.readFileSync(appConfigPath, \"utf-8\");\r\n\r\n        // Replace AppStack appName\r\n        content = content.replace(\r\n          /appName:\\s*[\"'`][^\"'`]+[\"'`]/,\r\n          `appName: \"${projectName}\"`\r\n        );\r\n\r\n        // Replace ApiGateway name\r\n        content = content.replace(\r\n          /name:\\s*[\"'`]my-serverless-app-\\$\\{self\\.stage\\}[\"'`]/,\r\n          `name: \"${projectName}-\\${self.stage}\"`\r\n        );\r\n\r\n        // Replace WebSocket name\r\n        content = content.replace(\r\n          /name:\\s*[\"'`]my-websocket-api-\\$\\{self\\.stage\\}[\"'`]/,\r\n          `name: \"${projectName}-\\${self.stage}\"`\r\n        );\r\n\r\n        fs.writeFileSync(appConfigPath, content);\r\n      }\r\n\r\n      // Path to lambda-cdk.ts\r\n      const lambdaCdkPath = join(targetDir, \"bin\", \"lambda-cdk.ts\");\r\n\r\n      if (fs.existsSync(lambdaCdkPath)) {\r\n        let content = fs.readFileSync(lambdaCdkPath, \"utf-8\");\r\n\r\n        // Replace stack id\r\n        content = content.replace(\r\n          /new CdkStack\\(\\s*app,\\s*`[^`]+-\\$\\{stageName\\}`/,\r\n          `new CdkStack(app, \\`${projectName}-\\${stageName}\\``\r\n        );\r\n\r\n        // Replace stackName\r\n        content = content.replace(\r\n          /stackName:\\s*`[^`]+-\\$\\{stageName\\}`/,\r\n          `stackName: \\`${projectName}-\\${stageName}\\``\r\n        );\r\n\r\n        fs.writeFileSync(lambdaCdkPath, content);\r\n      }\r\n\r\n      // Update apiGatewayName in all function config files\r\n      const apisDir = join(targetDir, \"src\", \"apis\", \"examples\");\r\n      updateApiGatewayNameInConfigFiles(apisDir, projectName);\r\n\r\n      console.log(\"Project created!\");\r\n      console.log(\r\n        `\\nNext steps:\\n  cd ${projectName}\\n  npm install\\n  npm run start`\r\n      );\r\n      return;\r\n    } catch (err) {\r\n      console.error(\"Error cloning template:\", err);\r\n      process.exit(1);\r\n    }\r\n  });\r\n\r\nprogram.parse(process.argv);\r\n\r\nfunction updateApiGatewayNameInConfigFiles(dir: string, projectName: string) {\r\n  if (!fs.existsSync(dir)) return;\r\n\r\n  const files = fs.readdirSync(dir, { withFileTypes: true });\r\n\r\n  for (const file of files) {\r\n    const fullPath = join(dir, file.name);\r\n\r\n    if (file.isDirectory()) {\r\n      updateApiGatewayNameInConfigFiles(fullPath, projectName);\r\n    }\r\n\r\n    if (file.isFile() && file.name.endsWith(\"config.ts\")) {\r\n      let content = fs.readFileSync(fullPath, \"utf-8\");\r\n\r\n      if (!content.includes(\"apiGatewayName\")) continue;\r\n\r\n      content = content.replace(\r\n        /apiGatewayName:\\s*[\"'`][^\"'`]+-\\$\\{self\\.stage\\}[\"'`]/g,\r\n        `apiGatewayName: \"${projectName}-\\${self.stage}\"`\r\n      );\r\n\r\n      fs.writeFileSync(fullPath, content);\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","names":["degit","fs"]}